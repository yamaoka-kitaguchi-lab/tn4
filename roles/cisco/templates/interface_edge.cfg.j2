{% for vlan in vlans %}
{% if not vlan.protected %}
vlan {{ vlan.vid }}
 name {{ vlan.name }}
{% endif %}
{% endfor %}

{% for interface, prop in interfaces.items() %}
interface {{ interface }}

{% if prop.description %}
 description {{ prop.description }}
{% else %}
 no description
{% endif %}

{% if prop.physical_uplink or prop.physical and prop.wifi %}
 lldp transmit
 lldp receive
{% elif prop.physical %}
 no lldp transmit
 no lldp receive
{% endif %}

{% if not prop.enabled %}
 shutdown
 no switchport
 no ip address
{% if prop.utp %}
 speed auto
 power inline never
{% endif %}

{% else %}
 no shutdown

{% if prop.uplink or prop.physical_uplink or prop.physical and prop.wifi %}
 no storm-control broadcast level
 no storm-control multicast level
 no storm-control unicast level
{% elif prop.physical %}
 storm-control broadcast level bps 3000000
 storm-control multicast level bps 3000000
{% endif %}

{% if prop.physical and not prop.physical_uplink %}
{% if prop.speed_10m %}
 speed 10
{% elif prop.speed_100m %}
 speed 100
{% elif prop.speed_1g %}
 speed 1000
{% else %}
 speed auto
{% endif %}

{% if prop.poe %}
 power inline auto
{% else %}
 power inline never
{% endif %}
{% endif %}

{% if not prop.physical_uplink %}
{% if prop.trunk_all %}
 switchport
 switchport mode trunk
{% elif prop.vlan_mode == "access" %}
 switchport
 switchport mode access
 switchport access vlan {{ prop.vids[0] }}
 no switchport trunk allowed vlan
{% elif prop.vlan_mode == "trunk" %}
 switchport
 switchport mode trunk
{% for removed_vids in prop.removed_vids %}
 switchport trunk allowed vlan remove {{ removed_vids | join(',') }}
{% endfor %}
 switchport trunk allowed vlan add {{ prop.vids | join(',') }}
{% else %}
 no switchport
{% endif %}

{% if prop.native_vid %}
 switchport trunk native vlan {{ prop.native_vid }}
{% else %}
 no switchport trunk native vlan
{% endif %}

{% elif prop.physical_uplink %}
 switchport
 switchport mode trunk
{% endif %}

{% endif %}
{% endfor %}
